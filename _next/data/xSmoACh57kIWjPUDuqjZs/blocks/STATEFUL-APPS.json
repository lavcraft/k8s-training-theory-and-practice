{"pageProps":{"name":"K8S - Stateful Apps","defaults":{"name":"K8S - Stateful Apps","order":20},"content":"\nK8S Statefull Apps\n==================\n4 —á–∞—Å–∞\n\n–í–≤–µ–¥–µ–Ω–∏–µ\n--------------\n\n- [ ] PV and PVC\n- [ ] Static vs Dynamic Provisioning\n- [ ] StatefulSet\n\nHands-on practice quest #00: working with pvc and statefulset\n-------------------------------------------------------------\n–ü—Ä–æ–±—É–µ–º –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è \"—Ñ–∞–π–ª–æ–≤—ã–º–∏\" —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–∞—à–∏—Ö –ø–æ–¥–∞—Ö\n\n**Given** —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã –ø–∞—Ä—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤  \n**When** —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–æ–º–∞–Ω–¥—ã –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç –∏—Ö –≤—ã–≤–æ–¥ –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ  \n**–ó–∞–¥–∞–Ω–∏–µ** –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å–æ `PersistentVolumeClaim` –∏ `StorageClass`\n\n```shell script\nkubectl explain pvc\nkubectl get storageclasses\n\ncat >sandwich-ingridients.yml <<EOF\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: sandwich-ingridients\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 20Mi\nEOF\n```\n\n`kubectl apply -f sandwich-ingridients.yml`\n\n**Then**: —Ä–µ—Å—É—Ä—Å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω\n1. –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –∫–∞–∫–æ–º —Å—Ç–∞—Ç—É—Å–µ —Å–µ–π—á–∞—Å –Ω–∞—à `PersistentVolumeClaim`?\n1. –î–æ—Å—Ç—É–ø–µ–Ω –ª–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–π `PersistentVolumeClaim` –≤–æ –≤—Å—ë–º –∫–ª–∞—Å—Ç–µ—Ä–µ –∏–ª–∏ —Ç–æ–ª—å–∫–æ –≤ –Ω–∞—à–µ–º –Ω–µ–π–º—Å–ø–µ–π—Å–µ? –ü–æ—á–µ–º—É?\n\n\n**–ó–∞–¥–∞–Ω–∏–µ**: –º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –∫–∞–∫–æ–π –ª–∏–±–æ `Pod` –∏–ª–∏ `Job`. –ó–∞–ø–∏—à–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ–≥–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å\n\n> –ü—Ä–∏–º–µ—Ä—ã `Pod` –∏–ª–∏ `Job` –≤—ã –º–æ–∂–µ—Ç–µ\n> 1. –≤–∑—è—Ç—å –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∑–∞–¥–∞–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä handson-03)\n> 2. –Ω–∞–ø–∏—Å–∞—Ç—å —Å–∞–º–∏\n> 3. –ø–æ–ª—É—á–∏—Ç—å —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—É `kubectl create/run` –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–Ω–∏—Ñ–µ—Å—Ç –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º\n\n```shell\nkubectl explain pod.spec.volumes.persistentVolumeClaim\nkubectl explain pod.spec.containers.volumeMounts\n\nvi sandwich-ingridients.yml\nkubectl apply -f sandwich-ingridients.yml\nkubectl exec -it <mypod> -- sh\necho \"tasty potatos\" > <mountdir>/potato\n\nkubectl delete pod <mypod>\nkubectl apply -f sandwich-ingridients.yml\n\n# –µ—Å–ª–∏ –≤—ã —Å–¥–µ–ª–∞–ª–∏ pod - –¥–æ–±–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä–æ–π –ø–æ–¥ —Å —Ç–µ–º –∂–µ PVC\nvi sandwich-ingridients.yml \nkubectl apply -f sandwich-ingridients.yml\n```\n\n**Then** —É—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–µ–ª—è—Ç—Å—è –≤–æ–∑–Ω–∏–∫—à–∏–º–∏ –∏ —Ä–µ—à–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –∏ –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã\n1. –ù–∞ –∫–∞–∫–æ–º —É–∑–ª–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –ø–æ–¥ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–∞?\n1. –ú–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ø–æ–¥ –Ω–∞ –¥—Ä—É–≥—É—é –Ω–æ–¥—É?\n1. –ú–æ–∂–Ω–æ –ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ—â—ë –æ–¥–∏–Ω –ø–æ–¥ —Å —ç—Ç–∏–º pvc? –ü–æ–ø—Ä–æ–±—É–π—Ç–µ\n1. –£–¥–∞–ª—è–µ—Ç—Å—è –ª–∏ PVC –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è Pod?\n1. –ú–æ–∂–Ω–æ –ª–∏ —É–¥–∞–ª–∏—Ç—å PVC –¥–æ —É–¥–∞–ª–µ–Ω–∏—è Pod?\n\nHands-on practice quest #01: Statefull apps scaling\n---------------------------------------------------\n–ü–µ—Ä–µ—Ö–æ–¥–∏–º –æ—Ç –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–∞ –∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–º –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏.\n–ü—Ä–æ–≤–æ–¥–∏–º –∞–Ω–∞–ª–æ–≥–∏–∏ —Å –∑–Ω–∞–Ω–∏—è–º–∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º–∏ –≤ –ø–µ—Ä–≤–æ–π —á–∞—Å—Ç–∏ —Ç—Ä–µ–Ω–∏–Ω–≥–∞\n\nüõí *–ú–∞—Ç–µ—Ä–∏–∞–ª—ã*\n1. [Creating a StatefulSet](https://kubernetes.io/docs/tutorials/stateful-application/basic-stateful-set/#creating-a-statefulset)\n\n**–ó–∞–¥–∞–Ω–∏–µ**: —Å–æ–∑–¥–∞–π—Ç–µ `statefulset` –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –µ–≥–æ —Ä–∞–∑–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–∞–º\n\n```shell\nkubectl explain statefulset.spec\n\n# –ø–µ—Ä–µ–¥–µ–ª—ã–≤–∞–µ–º —Å–≤–æ—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ StatefulSet –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ —Ä–µ–∂–∏–º–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤\nvi sandwich-ingridients.yml\nkubectl apply -f sandwich-ingridients.yml\nkubectl get pods\nkubectl get pvc\nkubectl exec -it debug -- sh\n[debug]$ nslookup <pod-static-name>.<stateful-service-name>\n```\n\n**–ó–∞–¥–∞–Ω–∏–µ**:\n1. –∑–∞–π–¥–∏—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –∑–∞–ø–∏—à–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ.\n1. –£–¥–∞–ª–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –Ω–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º statefulset.\n1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å—Ç–∞–ª–æ —Å –¥–∞–Ω–Ω—ã–º–∏\n1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ/–æ—Ç–º–∞—Å—à—Ç–∞–±–∏—Ä—É–π—Ç–µ `statefulset`\n\n–ü–æ–¥–≤–µ–¥–∏—Ç–µ –∏—Ç–æ–≥–∏:\n**Then** —É—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–µ–ª—è—Ç—Å—è –≤–æ–∑–Ω–∏–∫—à–∏–º–∏ –∏ —Ä–µ—à–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –∏ –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã\n- –ö–∞–∫ –≤–æ–∑–Ω–∏–∫–ª–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏?\n- –î–ª—è —á–µ–≥–æ –Ω—É–∂–µ–Ω `serviceName` –≤ `StatefulSet`?\n- –ú–æ–∂–µ—Ç –ª–∏ —É –ø–æ–¥–∞ –∏–∑ `StatefulSet` –º–µ–Ω—è—Ç—å—Å—è IP?\n- –î–ª—è —á–µ–≥–æ —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Service —Å `clusterIP: None`?\n- –ö–æ–≥–¥–∞ —É–¥–∞–ª—è—é—Ç—Å—è PVC?\n- –ö–æ–≥–¥–∞ —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π PV?\n- –í –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ–¥—ã –≤ `StatefulSet`?"},"__N_SSG":true}